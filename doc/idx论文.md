# Motivation

近年来，面向浏览器 Web API 的模糊测试研究逐渐兴起，成为前端安全分析与漏洞挖掘中的重要手段。已有工作主要聚焦于不同类型的浏览器组件，通过语义建模与调用序列生成对核心攻击面展开探索。例如，Minerva 作为一项代表性的 whole browser fuzzing 框架，通过动态依赖分析刻画不同 Web API 之间的交互关系，生成高度关联的调用序列，以发现跨组件间潜在的逻辑缺陷。Favocado 则聚焦于 JavaScript 与 Native 层之间的绑定接口，自动解析 WebIDL 描述与类型系统，生成语义完备的调用脚本，并结合对象等价类对输入空间进行约简，着力于揭示类型转换与生命周期管理中的深层次安全隐患。

与此同时，研究社区还提出了大量面向特定 Web API 子域的定向模糊测试工具。例如，Domato 与 FreeDom 专注于 DOM 结构操作与渲染流程测试，Canvas、WebGL、WebAudio、ServiceWorker 及 WebGPU 等接口亦分别催生出针对性测试框架，从而显著扩展了浏览器攻击面在图形、媒体与异步计算方向上的测试深度与广度。

尽管上述研究在多个子系统取得了良好成效，但对于 IndexedDB 这一内建持久化存储组件仍缺乏系统性的测试手段。IndexedDB 拥有独特的语义特性，包括版本迁移机制、事务隔离模型、异步事件链驱动以及底层的磁盘交互，其接口使用过程中存在严格的阶段划分。例如，数据库结构（如 object store 或 index）仅允许在 onupgradeneeded 事件中定义或修改，而事务中的数据操作又高度依赖事件驱动的异步调度逻辑。这类特性要求测试工具具备对阶段性上下文与事件链依赖的精确建模能力，而现有模糊测试器通常采用线性拼接或上下文无关的 API 调度策略，难以构造合法且有语义效力的操作序列。

此外，部分模糊器（如 FreeDom）为保证输入脚本执行成功，往往在所有 API 调用外层统一包裹 try/catch 块以抑制异常传播，这种做法虽然提升了脚本执行率，但也带来了显著的性能损耗，并掩盖了应被暴露的运行时异常。更为关键的是，IndexedDB 的 fuzzing 并非仅依赖接口序列的多样性，更依赖于高质量的结构化数据生成能力。然而现有工作在数据生成方面仍采用随机拼接与字典替换的简单策略，缺乏与 schema 对齐的语义支持，难以触发关键路径。

综上所述，当前 Web API fuzzing 在持久化存储方向仍存在显著空白。IndexedDB 作为浏览器内建的事务型数据库，其多态状态机、异步调度与存储语义的耦合特性，为模糊测试提出了更高挑战，也构成了补齐 Web API 安全测试版图的关键支点。





# IDBFuzz

针对Indexeddb的异步事件驱动和面向对象存储等特性，我们致力于构建IDXFuzzer框架，一个专为浏览器端结构化存储接口设计的模糊测试工具，该框架通过可控语义中间表示语言生成精准的异步操作流，并解耦种子和数据生成，结合覆盖率反馈机制并行探索有趣种子结构和具备路径触发潜力的关键键值对，从而推动结构化模糊测试在浏览器持久化接口上的落地

## WorkFlow

在浏览器端存储领域，我们提出了一个面向 IndexedDB 的结构化模糊测试框架 **IDXFuzzer**，该框架融合了语义驱动与数据驱动两类核心机制，整体设计包含三个主要模块：(i) **schema 解析模块**，该模块基于 MDN 文档与 WebIDL 规范，自动抽象出完整的 IndexedDB 接口 schema，并进一步解析为支持链式访问的 schemaTree，以此确保后续单 API 调用与类型推断的准确性；(ii) **中间表示构造模块**，用于生成轻量化的中间语言（IR），以表达典型的 IndexedDB 操作流程。该 IR 由语义层与语法层协同组成，语法层保留了传统 AST 中必要节点（如 `MemberExpression`、`Assignment`、`FunctionExpression` 等），而语义层则结合 IDB 特性设计了超过 20 个层级，按功能划分为调用层、注册层、执行层与访问层，分别对应数据库入口调用、事件注册、数据维护与数据状态查询阶段。各层之间具有关联与嵌套关系，支持递归生成与多层融合。(iii) **上下文建模模块**，考虑到 IndexedDB 的事件驱动特性及 IR 构建过程需动态追踪数据库状态，我们设计了 `IRContext` 与 `IDBContext` 两类上下文机制。前者负责在作用域间记录变量声明、类型信息与可见对象集合，后者则自数据库初始化起持续维护结构快照，包括表结构、索引配置、键属性与事务状态等。需注意的是，该模块并不记录具体的键值数据（即 item 值），避免引入冗余开销。

最后，针对 IndexedDB 中对象存储的特殊性，我们设计了一套独立的数据生成与管理机制，实现了语义种子与存储数据的解耦。所有对象项（item）并不直接嵌入 IR，而是通过高潜力数据池进行持久化管理。该数据池中的项可根据 IR 中的 `IDBContext` 信息（如 keyPath、multiEntry 等）灵活匹配填充，以适配多种关键路径结构。整个 fuzzing 流程通过覆盖率反馈机制引导，不断探索兼具结构多样性与路径触发潜力的种子–数据组合，从而提升模糊测试的有效性与深度。

## IR

本系统采用上下文驱动的分层 IR 构建框架，Layer设计的第一点优势在于我们可以保证语义正确性可控的去实现IR，如果我们想测试chromium对于错误的构造是否稳定，只需变异成错误的层次结构，同时在对应的层次里生成不符合schema错误的节点即可，这样可以同时保证严格使用影响性能的try catch语句，第二点优势在于我们可以对IDB的特定业务进行针对性测试，文献xxx中发现open方法就有N种bug，我们可以针对数据库连接、并发事务、频繁读写、嵌套事件等等场景进行定制化测试。

在构建期间，`IDBContext` 负责维护数据库结构定义（如 object store 与 index 的 schema 信息），而 `IRContext` 则用于追踪变量声明、作用域状态与语义约束，两者共同构成语义感知的上下文环境，贯穿 IR 构建全程。

我们以图1中表结构初始化为例，简要说明各阶段 IR 的设计与生成：

- **数据库连接阶段**：由 `IDBRootLayer` 发起 `indexedDB.open()` 调用，并注册 `onupgradeneeded` 等事件监听器；
- **结构变更阶段**：进入 `IDBDatabase_SchemaOps_Layer`，生成结构操作，包括 `createObjectStore`、`deleteObjectStore`、`createIndex` 和 `deleteIndex`；
- **数据初始化阶段**：执行 object store 核心接口（如 `put`、`add`、`get`、`delete` 等），该阶段涵盖大量事务操作，是测试语义行为与事务特性的关键；
- **事件流生成阶段**：IndexedDB 的操作均以事件驱动方式异步执行，不同事件可嵌套或并行形成复杂 event flow。在构建过程中，需依据 `IDBContext` 的结构快照及 `IRContext` 的变量状态，动态生成符合依赖关系的后续层。

为进一步捕捉事务语义与执行行为，我们将 object store 的每个接口抽象为 **PipeEnd**，接口间的顺序关系建模为 **Pipe**，多个 Pipe 组合为 **PipeFlow**。考虑到不同接口序列的测试价值差异，我们设计了基于结构依赖的权重划分机制：

- **高权重 Pipe**：如 `put/get`、`add/delete` 等具有明确读写依赖的操作序列，有助于验证事务的隔离性与原子性；
- **中权重 Pipe**：如对同一对象的多次查询，体现典型的自循环模式；
- **低权重 Pipe**：如 `getAllKeys/getAll` 等冗余、低效的无依赖访问模式。

基于此 **PipeGraph** 架构，如图2所示，系统可按需随机生成具有长度、数据依赖与语义多样性的 PipeFlow，实现具备行为驱动特性的测试输入生成。

此外，系统实现了双向转换模块 Lifter，可在 IR 与 JavaScript 代码之间无损映射，便于前后端集成与结果验证，相关细节此处不再赘述。

**图1：IR简单构建流程.drawio**

**图2：pipegraph.png**





## ItemDriver